const firstPlayerBlock=document.getElementById("first-player"),secondPlayerBlock=document.getElementById("second-player"),firstPlayerScoreButton=document.querySelector(".first-player-point-button"),secondPlayerScoreButton=document.querySelector(".second-player-point-button");function buildScoreRequest(e){return{pointWinner:e}}function setupScore(e){function t(t,r){return t<=3&&r<=3?function(t){switch(t){case 0:return"0";case 1:return"15";case 2:return"30";case 3:return"40";default:throw new Error("Invalid score: "+e)}}(t):t>r?"AD":t<r||t===r?"40":"err"}let r=e.inTiebreak?e.currentPoints.ONE:t(+e.currentPoints.ONE,+e.currentPoints.TWO),n=e.inTiebreak?e.currentPoints.TWO:t(+e.currentPoints.TWO,+e.currentPoints.ONE);setupGameLabel(e.inTiebreak),setUpPlayerScore(firstPlayerBlock,e.firstPlayer,e.sets.ONE,r),setUpPlayerScore(secondPlayerBlock,e.secondPlayer,e.sets.TWO,n)}function setupGameLabel(e){const t=document.querySelector(".score-names .points");e?(updateElement(t,"TIEBREAK"),t.style.color="red"):(updateElement(t,"GAME"),t.style.color="rgb(210, 210, 210)")}function setupPointListeners(){document.querySelectorAll(".score-element").forEach((e=>{new MutationObserver((function(t,r){for(const r of t){const t=r.target.textContent;"childList"!==r.type&&"characterData"!==r.type||"0"===t||(e.classList.add("highlight"),firstPlayerScoreButton.querySelector("button").disabled=!0,secondPlayerScoreButton.querySelector("button").disabled=!0,setTimeout((()=>{e.classList.remove("highlight"),firstPlayerScoreButton.querySelector("button").disabled=!1,secondPlayerScoreButton.querySelector("button").disabled=!1}),300))}})).observe(e,{childList:!0,characterData:!0,subtree:!0})}))}function updateElement(e,t){e.innerHTML!==String(t).trim()&&(e.innerHTML=t)}function setUpPlayerScore(e,t,r,n){updateElement(e.querySelector("h4"),t),updateElement(e.querySelector(".points"),n),updateElement(e.querySelector(".set1"),r[0]),updateElement(e.querySelector(".set2"),r[1]),updateElement(e.querySelector(".set3"),r[2])}function sendScoreRequest(e){let t=window.location.search,r=context+match_score_api+t;fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(e.url.includes(t))return e.json();window.location.href=e.url})).then((e=>{setupScore(e)})).catch((e=>{console.error("err",e)}))}function setupPlayerScoreButton(e,t){let r=e.querySelector(".btn-point");r.innerHTML="Point to "+t,r.addEventListener("click",(function(){sendScoreRequest(buildScoreRequest(t))}))}document.addEventListener("DOMContentLoaded",(function(){let e=context+match_score_api+window.location.search;fetch(e).then((e=>e.ok?e.json():e.json().then((e=>{throw new Error(e.message)})))).then((e=>{setupScore(e),setupPlayerScoreButton(firstPlayerScoreButton,e.firstPlayer),setupPlayerScoreButton(secondPlayerScoreButton,e.secondPlayer),setupPointListeners()})).catch((e=>{alert(e.message),window.location.href=context}))}));